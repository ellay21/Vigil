# Industrial Safety Monitoring Backend

Minimal, production-ready backend for an industrial safety monitoring system.
Receives data from embedded devices (ATmega + SIM800 GSM) via HTTP POST.

## Tech Stack

- **Runtime:** Node.js
- **Language:** TypeScript
- **Framework:** Express
- **Database:** SQLite
- **Validation:** Zod

## Project Structure

```
src/
├── db.ts        # Database initialization and schema
├── server.ts    # Express server and API endpoints
├── types.ts     # Data models and validation schemas
```

## Setup & Run

1.  **Install dependencies:**
    ```bash
    npm install
    ```

2.  **Run in development mode:**
    ```bash
    npm run dev
    ```

3.  **Build and run in production:**
    ```bash
    npm run build
    npm start
    ```

## API Endpoints

### POST /api/device/data

Receives sensor data from devices.

**Request Body:**

```json
{
  "device_id": "IND-001",
  "temperature": 92,
  "smoke": 1,
  "light": 800,
  "state": "DANGER",
  "timestamp": "2023-10-27T10:00:00Z"
}
```

### GET /api/device/:id/risk

AI-powered risk assessment.

### GET /api/device/:id/explanation

AI-generated human-readable explanation of device state.

### GET /api/device/:id/voice

Returns text explanation and a TTS audio URL for voice alerts.

### GET /api/summary

System-wide safety summary generated by AI.

## Testing

See [TESTING_GUIDE.md](TESTING_GUIDE.md) for manual testing instructions.

**Response:**

- `200 OK`: Data received successfully.
- `400 Bad Request`: Invalid payload.
- `500 Internal Server Error`: Server error.

## Database Schema

- **devices**: Stores device metadata (`id`, `last_seen`, `current_state`).
- **readings**: Stores sensor readings (`device_id`, `temperature`, `smoke`, `light`, `state`, `timestamp`).
